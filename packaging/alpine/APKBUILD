# Maintainer: Bostjan Skufca Jese <bostjan@skufca.si>
pkgname="snoopy"
#pkgver=`cd ../.. && ./dev-tools/libexec/get-release-version.sh -i | sed -e 's/-//g'`
pkgver=0.0.1_alpha999
pkgrel=1
pkgdesc="Snoopy Command Logger is a wrapper around execve() that captures all executed commands by all users and all processes."
arch="x86_64"
url="https://github.com/a2o/snoopy"
license="GPL"
depends="musl"
makedepends="autoconf automake diffutils file gcc git libtool m4 make"
checkdepends="procps socat"


#install=""
#source=""

# Even when we symlink this file into the git root, abuild chdirs into packaging/alpine/builddir
#srcdir="../../.."
#builddir="builddir"


#install="packaging/arch/snoopy.install"
changelog=ChangeLog


clean() {
    echo "PWD in clean(): $PWD"
    true
}


prepare() {
    echo "PWD in prepare(): $PWD"

    OLDPWD="$PWD"
    cd ../..

    if [ ! -f ./configure ]; then
        ./bootstrap.sh
    fi

    cd "$OLDPWD"
}


build() {
    echo "PWD in build(): $PWD"
    echo "pkgdir: $pkgdir"

    OLDPWD="$PWD"
    cd ../..

    ./configure --prefix=/usr --sysconfdir=/etc
    make -j4

    cd "$OLDPWD"
}


check() {
    OLDPWD="$PWD"
    cd ../..

    make -j4 check

    cd "$OLDPWD"
}


package() {
    # Switches to "$builddir" automatically
    OLDPWD="$PWD"
    cd ../..

    make DESTDIR="$pkgdir" install

    cd "$OLDPWD"
}
